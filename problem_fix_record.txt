问题修复版本记录（回归清单）

目标
1) 每次改动前：按“回归检查清单”逐项快速过一遍，避免已修复问题复发
2) 每次改动后：同样逐项复核，并把本次改动写入“版本记录”

约定
- Build ID：YYYY-MM-DD_nn（同一天第 nn 次修复版本）
- 影响面：只要改动涉及 reader 交互/CSS/菜单/查询面板/翻页手势，都必须刷一遍清单
- 验证口径：优先以 iOS 真机 Safari/PWA 为准；桌面浏览器只做辅助

回归检查清单（每次更新前/后都要刷）

[R-001] iOS 正文中间区域轻点可唤起菜单
步骤：打开任意 TXT 阅读 -> 隐藏菜单 -> 轻点正文中间区域
期望：顶部栏+底部栏出现（menu-visible 生效）

[R-002] iOS 正文中间区域再次轻点可关闭菜单
步骤：菜单已显示 -> 轻点正文中间区域
期望：顶部栏+底部栏隐藏

[R-003] iOS 选择文本后不需要“长按再点”才能唤起/关闭菜单
步骤：随意选中一段文字 -> 取消选区/保持选区 -> 轻点正文中间区域
期望：菜单唤起/关闭仍稳定，不被选区状态卡死

[R-004] 菜单打开时，点正文可优先关闭浮层面板（目录/设置/更多/查询）
步骤：分别打开 目录、设置、更多、查询面板 -> 轻点正文区域
期望：先关闭面板；再次轻点再切换 menu-visible

[R-005] 底部导航栏图标与文字垂直居中，不贴死底部
步骤：打开菜单，观察底部三项（目录/夜间/设置）
期望：图标+文字整体在底部栏可视区域居中；safe-area 不挤压内容

[R-006] 底部栏高度锁定，不受其它功能 CSS 改动影响
步骤：切换夜间/设置面板打开关闭/翻页模式切换/查询面板开关后观察
期望：底部栏高度与对齐不跳动、不漂移

[R-007] 查询面板显示本地解释（拼音/释义/来源），而不是只有外链按钮
步骤：选中文本 -> 点“查询”按钮 -> 等待结果
期望：queryResult 中出现标题、拼音、释义列表、来源（缺项时提示但不空白）

[R-008] 查询面板可关闭，且关闭后不影响菜单开关
步骤：打开查询面板 -> 点“关闭”按钮/点遮罩/点正文
期望：查询面板关闭；菜单开关仍正常

[R-009] 翻页/滚动手势与“点按唤起菜单”互不干扰
步骤：快速滑动翻页/滚动 -> 立刻轻点正文中间区域
期望：不会因为刚刚的翻页手势导致菜单无法唤起（或需要多次点击）

[R-010] 功能区域隔离：修改翻页/查询/CSS 不影响底部栏与菜单
步骤：完成任一功能改动后，复测 R-001~R-009
期望：无新增回归

版本记录（按时间倒序追加）

Build ID: 2026-02-04_03
时间: 2026-02-04 16:10:00
涉及文件: design_v14_functionality.html, problem_fix_record.txt
改动摘要:
- iOS 角落点按翻页区扩大：四角命中区域在 iOS 上扩大 20%，降低误触发菜单概率
- 菜单触发区域收敛：四角只执行翻页/上下翻页；仅正文中间区域可唤起/关闭菜单（TXT/EPUB）
- 事件冲突处理：TXT 的 document 捕获点击不再抢占菜单切换，避免与正文内部翻页点击逻辑打架
本次回归结果（填写 PRE/POST）:
- PRE: iOS 点击四角偶发弹出菜单；四角翻页区域偏小
- POST: 桌面浏览器自检通过；iOS 真机 Safari/PWA 待验证

Build ID: 2026-02-04_02
时间: 2026-02-04 15:21:41
涉及文件: design_v14_functionality.html
改动摘要:
- 关闭保存去重：移除关闭按钮 onpointerdown 的非 await 保存，避免与 closeBook 保存产生写入竞态导致“回退偏移”
- 滚动惯性收敛：closeBook 保存前等待滚动稳定（适配 iOS 惯性滚动），减少“回退后上移一行”
本次回归结果（填写 PRE/POST）:
- PRE: 返回书架再进入，正文位置偶发上移约 1 行
- POST: 桌面浏览器自检通过；iOS 真机 Safari/PWA 待验证

Build ID: 2026-02-04_01
时间: 2026-02-04 14:31:39
涉及文件: design_v14_functionality.html
改动摘要:
- Reader 全局手势：将 touch/click 监听提升到 document 捕获阶段，避免 iOS PWA/滚动容器导致正文点按失效
- EPUB iframe 交互：在 iframe 内补齐“轻点唤起/关闭菜单”与“左侧边缘右滑返回”识别逻辑
- 返回进度：边缘右滑触发 closeBook，复用 closeBook 内的进度保存逻辑（TXT/EPUB）
本次回归结果（填写 PRE/POST）:
- PRE: iOS PWA（部分场景）正文轻点无法唤起菜单；EPUB 内左侧边缘右滑不生效
- POST: 桌面浏览器自检 R-001~R-010 通过；iOS 真机 Safari/PWA 待验证

Build ID: 2026-02-03_01
时间: 2026-02-03
涉及文件: design_v14_functionality.html
改动摘要:
- 菜单切换：允许“面板打开时”点正文走关闭逻辑（不再被提前 return 挡住）
- EPUB 交互：点击不再被选区检查卡死；点正文可关闭查询面板
- 底部栏布局：使用 height + padding-bottom(safe-area) 固定高度与垂直居中，避免“贴死底部”
本次回归结果（填写 PRE/POST）:
- PRE: 未填写
- POST: 未填写
